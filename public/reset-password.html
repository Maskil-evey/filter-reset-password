<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Your Password</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #2FB9B1 0%, #2FB9B1 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column; 
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      /* Logo container styling */
      .logo-container {
        /* margin-bottom: 30px; */
        text-align: center;
      }

      .logo-img {
        width: 100px;
        height: auto;
        /* margin-bottom: 10px; */
      }

      .logo-text {
        font-size: 32px;
        font-weight: bold;
        background: linear-gradient(135deg, #2FB9B1 0%, #2FB9B1 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: white; /* Fallback color */
      }

      .container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 450px;
        width: 100%;
        padding: 60px;
      }

      h1 {
        font-size: 24px;
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }

      .subtitle {
        color: #666;
        text-align: center;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
        font-size: 14px;
      }

      input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input:focus {
        outline: none;
        border-color: #2FB9B1;
      }

      button {
        width: 100%;
        padding: 14px;
        background: #2FB9B1;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .message {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .message.error {
        background: #fee;
        color: #c33;
        border: 1px solid #fcc;
      }

      .message.success {
        background: #efe;
        color: #3c3;
        border: 1px solid #cfc;
      }

      .message.show {
        display: block;
      }

      .loading {
        text-align: center;
        color: #666;
        padding: 20px;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #2FB9B1;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .password-requirements {
        font-size: 12px;
        color: #666;
        margin-top: 8px;
      }

      .back-link {
        text-align: center;
        margin-top: 20px;
      }

      .back-link a {
        color: #667eea;
        text-decoration: none;
        font-size: 14px;
      }

      .back-link a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <!-- Logo Container - Now properly styled and positioned -->
    <div class="logo-container">
      <img src="/my-password-reset/assets/logo.png" alt="Filter Logo" class="logo-img" style="height: 70px; width: 70px;" />
      <div class="logo-text">Filter</div>
    </div>

    <div class="container">
      <!-- Removed the logo from inside the container since it's now above -->

      <div id="loadingSection" class="loading">
        <div class="spinner"></div>
        <p>Verifying your request...</p>
      </div>

      <div id="resetSection" style="display: none">
        <h1>Reset Your Password</h1>
        <p class="subtitle">Enter your new password below</p>

        <div id="message" class="message"></div>

        <form id="resetForm">
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input
              type="password"
              id="newPassword"
              minlength="6"
              required
            />
            <div class="password-requirements">Minimum 6 characters</div>
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              minlength="6"
              required
            />
          </div>
          <button type="submit" id="submitBtn">Reset Password</button>
        </form>
      </div>

      <div id="errorSection" style="display: none">
        <h1>Invalid or Expired Link</h1>
        <p class="subtitle">
          This password reset link is invalid or has expired.
        </p>
      </div>

      <div id="successSection" style="display: none">
        <h1>Password Reset Successful!</h1>
        <p class="subtitle">Your password has been changed successfully.</p>
        <!-- got to app and login message-->
        <p class="subtitle">Go to app and login</p>
      </div>
    </div>

    <script type="module">
      // Firebase configuration - REPLACE WITH YOUR CONFIG
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        verifyPasswordResetCode,
        confirmPasswordReset,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // Your Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDlQ5DuhGRFF7TAtdXmICHlLTWecgjcuDs",
        authDomain: "filter-2abf1.firebaseapp.com",
        projectId: "filter-2abf1",
        storageBucket: "filter-2abf1.appspot.com",
        messagingSenderId: "20869443991",
        appId: "1:20869443991:web:46bb26d450514a483ad4d2",
        measurementId: "G-YBZWFPBQ3C",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const mode = urlParams.get("mode");
      const oobCode = urlParams.get("oobCode");

      // DOM elements
      const loadingSection = document.getElementById("loadingSection");
      const resetSection = document.getElementById("resetSection");
      const errorSection = document.getElementById("errorSection");
      const successSection = document.getElementById("successSection");
      const resetForm = document.getElementById("resetForm");
      const messageDiv = document.getElementById("message");
      const submitBtn = document.getElementById("submitBtn");
      const newPasswordInput = document.getElementById("newPassword");
      const confirmPasswordInput = document.getElementById("confirmPassword");

      // Show message function
      function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.className = `message ${type} show`;
      }

      // Hide message function
      function hideMessage() {
        messageDiv.className = "message";
      }

      // Verify the reset code
      async function verifyResetCode() {
        if (mode !== "resetPassword" || !oobCode) {
          loadingSection.style.display = "none";
          errorSection.style.display = "block";
          return;
        }

        try {
          // Verify the password reset code is valid
          await verifyPasswordResetCode(auth, oobCode);

          // Code is valid, show the reset form
          loadingSection.style.display = "none";
          resetSection.style.display = "block";
        } catch (error) {
          console.error("Error verifying code:", error);
          loadingSection.style.display = "none";
          errorSection.style.display = "block";
        }
      }

      // Handle form submission
      resetForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessage();

        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Validate passwords match
        if (newPassword !== confirmPassword) {
          showMessage("Passwords do not match", "error");
          return;
        }

        // Validate password length
        if (newPassword.length < 6) {
          showMessage("Password must be at least 6 characters", "error");
          return;
        }

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = "Resetting...";

        try {
          // Confirm the password reset
          await confirmPasswordReset(auth, oobCode, newPassword);

          // Success! Show success section
          resetSection.style.display = "none";
          successSection.style.display = "block";
        } catch (error) {
          console.error("Error resetting password:", error);
          let errorMessage = "An error occurred. Please try again.";

          if (error.code === "auth/weak-password") {
            errorMessage =
              "Password is too weak. Please use a stronger password.";
          } else if (error.code === "auth/expired-action-code") {
            errorMessage = "Reset link has expired. Please request a new one.";
          } else if (error.code === "auth/invalid-action-code") {
            errorMessage = "Invalid reset link. Please request a new one.";
          }

          showMessage(errorMessage, "error");
          submitBtn.disabled = false;
          submitBtn.textContent = "Reset Password";
        }
      });

      // Start verification when page loads
      verifyResetCode();
    </script>
  </body>
</html>